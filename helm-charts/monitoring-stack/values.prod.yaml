# Production environment - Production-hardened monitoring

kubePrometheusStack:
  enabled: true
  
  prometheus:
    retention: 30d  # Longer retention for production
    scrapeInterval: 15s  # More frequent scraping
    scrapeTimeout: 10s
    evaluationInterval: 15s  # Faster alert evaluation
    
    storage:
      enabled: true
      size: 100Gi  # Larger storage for production
    
    resources:
      requests:
        cpu: 1000m
        memory: 4Gi
      limits:
        cpu: 4000m
        memory: 8Gi
    
    externalLabels:
      cluster: production-k8s
      environment: production
    
    # Production: Enable remote write for long-term storage (Thanos/Mimir)
    # remoteWrite:
    #   - url: http://thanos-receive.monitoring.svc:19291/api/v1/receive
  
  grafana:
    enabled: true
    adminPassword: ""  # TODO: Use External Secret in production
    persistence:
      enabled: true
      size: 20Gi
    
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi
    
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
        searchNamespace: ALL
    
    # Grafana server configuration for production
    grafana.ini:
      server:
        domain: platform.example.com
        root_url: "https://platform.example.com/grafana"
        serve_from_sub_path: true
      # ==============================================================================
      # Keycloak OAuth Configuration (Production)
      # ==============================================================================
      auth.generic_oauth:
        enabled: true
        name: "Keycloak"
        allow_sign_up: true
        client_id: "grafana"
        scopes: "openid profile email groups"
        auth_url: "https://platform.example.com/keycloak/realms/platform/protocol/openid-connect/auth"
        token_url: "https://platform.example.com/keycloak/realms/platform/protocol/openid-connect/token"
        api_url: "https://platform.example.com/keycloak/realms/platform/protocol/openid-connect/userinfo"
        role_attribute_path: "contains(groups[*], '/grafana-admins') && 'Admin' || contains(groups[*], '/grafana-editors') && 'Editor' || 'Viewer'"
        role_attribute_strict: false
        groups_attribute_path: "groups"
        use_pkce: true
    
    # Load client secret from environment
    envFromSecret: grafana-oauth-secret

# Enable External Secrets Operator monitoring in production
externalSecretsOperator:
  monitoring:
    enabled: true

# Loki Stack - Phase 2
lokiStack:
  enabled: false  # Enable in Phase 2
  
  loki:
    retention: 336h  # 14 days for production
    persistence:
      enabled: true
      size: 50Gi
