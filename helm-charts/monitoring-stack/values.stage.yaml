# Staging environment - Enable full monitoring stack

kubePrometheusStack:
  enabled: true  # Enable Prometheus Operator in staging
  
  prometheus:
    retention: 15d
    scrapeInterval: 30s  # 30s scrape for staging
    
    storage:
      enabled: true
      size: 50Gi
    
    externalLabels:
      cluster: staging-k8s
      environment: staging
  
  grafana:
    enabled: true
    adminPassword: "changeme-staging"  # TODO: Move to External Secret
    persistence:
      enabled: true
      size: 10Gi
    
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
        searchNamespace: ALL  # Discover dashboards in all namespaces
    
    # ==============================================================================
    # Keycloak OAuth2/OIDC Configuration for Staging
    # ==============================================================================
    # TODO: Enable after Keycloak deployment and client creation
    # ==============================================================================
    auth:
      enabled: false  # TODO: Set to true after Keycloak setup
      keycloak:
        enabled: false  # TODO: Set to true after Keycloak setup
        authUrl: "http://keycloak.keycloak.svc.cluster.local/realms/platform/protocol/openid-connect/auth"
        tokenUrl: "http://keycloak.keycloak.svc.cluster.local/realms/platform/protocol/openid-connect/token"
        apiUrl: "http://keycloak.keycloak.svc.cluster.local/realms/platform/protocol/openid-connect/userinfo"
        clientId: "grafana"
        # clientSecret loaded from ExternalSecret: keycloak-client-secrets (key: grafana-secret)
        scopes: "openid profile email groups"
        roleAttributePath: "contains(groups[*], '/grafana-admins') && 'Admin' || contains(groups[*], '/grafana-editors') && 'Editor' || 'Viewer'"
        allowSignUp: true

# Enable External Secrets Operator monitoring in staging
externalSecretsOperator:
  monitoring:
    enabled: false  # TEMPORARILY DISABLED - Enable after kube-prometheus-stack installs CRDs

# Loki Stack - Phase 2 (disabled for now)
lokiStack:
  enabled: false  # Enable in Phase 2 for log aggregation
